<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penyakit Jantung Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .step-description { margin-bottom: 20px; }
        .step-content { margin-bottom: 40px; }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center mb-4">Prediksi Penyakit Jantung</h1>
    <div id="form-steps">
        <!-- Steps will be dynamically generated -->
    </div>
    <div class="d-flex justify-content-between">
        <button id="prevBtn" class="btn btn-secondary" onclick="prevStep()">Previous</button>
        <button id="nextBtn" class="btn btn-primary" onclick="nextStep()">Next</button>
    </div>
</div>

<!-- Modal for Results -->
<div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="resultModalLabel">Hasil Prediksi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="resultMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<script>
    const steps = [
        { label: "Age", desc: "Usia pasien dalam tahun.", type: "number" },
        { label: "Sex", desc: "Jenis kelamin pasien (0 = Perempuan, 1 = Laki-laki).", type: "select", options: { 0: "Perempuan", 1: "Laki-laki" }},
        { label: "Chest Pain Type (CP)", desc: "Jenis nyeri dada pasien. (0 = Typical angina, 1 = Atypical angina, 2 = Non-anginal pain, 3 = Asymptomatic).", type: "select", options: { 0: "Typical Angina", 1: "Atypical Angina", 2: "Non-Anginal Pain", 3: "Asymptomatic" }},
        { label: "Resting Blood Pressure (trestbps)", desc: "Tekanan darah sistolik pasien (mmHg).", type: "number" },
        { label: "Serum Cholesterol (chol)", desc: "Tingkat kolesterol dalam darah pasien (mg/dl).", type: "number" },
        { label: "Fasting Blood Sugar (fbs)", desc: "Apakah gula darah saat puasa > 120 mg/dl (0 = Tidak, 1 = Ya).", type: "select", options: { 0: "Tidak", 1: "Ya" }},
        { label: "Resting ECG (restecg)", desc: "Hasil EKG saat istirahat. (0 = Normal, 1 = Abnormal ST-T, 2 = Kemungkinan hipertrofi ventrikel kiri).", type: "select", options: { 0: "Normal", 1: "Abnormal ST-T", 2: "Hipertrofi Ventrikel Kiri" }},
        { label: "Max Heart Rate (thalach)", desc: "Denyut jantung maksimum selama latihan fisik.", type: "number" },
        { label: "Exercise Angina (exang)", desc: "Apakah ada nyeri dada saat olahraga? (0 = Tidak, 1 = Ya).", type: "select", options: { 0: "Tidak", 1: "Ya" }},
        { label: "ST Depression (oldpeak)", desc: "Depresi segmen ST akibat olahraga dibandingkan istirahat.", type: "number" },
        { label: "ST Slope (slope)", desc: "Kemiringan segmen ST selama denyut jantung meningkat. (0 = Menurun, 1 = Mendatar, 2 = Meningkat).", type: "select", options: { 0: "Menurun", 1: "Mendatar", 2: "Meningkat" }},
        { label: "Major Vessels (ca)", desc: "Jumlah pembuluh darah utama yang terlihat menyempit melalui fluoroskopi.", type: "number" },
        { label: "Thalassemia (thal)", desc: "Hasil tes thalassemia. (0 = Normal, 1 = Fixed Defect, 2 = Reversible Defect).", type: "select", options: { 0: "Normal", 1: "Fixed Defect", 2: "Reversible Defect" }},
    ];

    const formSteps = document.getElementById('form-steps');
    const formData = {};
    let currentStep = 0;

    function renderStep(stepIndex) {
        formSteps.innerHTML = ""; 
        const step = steps[stepIndex];
        formSteps.innerHTML = `
            <div class="step-description">
                <h4>${step.label}</h4>
                <p>${step.desc}</p>
            </div>
            <div class="step-content">
                ${
                    step.type === "number"
                        ? `<input type="number" id="stepInput" class="form-control" />`
                        : `
                        <select id="stepInput" class="form-control">
                            ${Object.entries(step.options).map(([key, value]) => `<option value="${key}">${value}</option>`).join("")}
                        </select>
                        `
                }
            </div>
        `;
        if (formData[step.label] !== undefined) {
            document.getElementById("stepInput").value = formData[step.label];
        }
    }

    function nextStep() {
        const stepInput = document.getElementById("stepInput").value;
        if (stepInput === "") {
            alert("Silakan isi data untuk melanjutkan.");
            return;
        }
        formData[steps[currentStep].label] = stepInput;
        currentStep++;
        if (currentStep < steps.length) {
            renderStep(currentStep);
        } else {
            sendData();
        }
    }

    function prevStep() {
        if (currentStep > 0) {
            currentStep--;
            renderStep(currentStep);
        }
    }

    function sendData() {
        const payload = {
            age: parseInt(formData["Age"], 10),
            sex: parseInt(formData["Sex"], 10),
            cp: parseInt(formData["Chest Pain Type (CP)"], 10),
            trestbps: parseInt(formData["Resting Blood Pressure (trestbps)"], 10),
            chol: parseInt(formData["Serum Cholesterol (chol)"], 10),
            fbs: parseInt(formData["Fasting Blood Sugar (fbs)"], 10),
            restecg: parseInt(formData["Resting ECG (restecg)"], 10),
            thalach: parseInt(formData["Max Heart Rate (thalach)"], 10),
            exang: parseInt(formData["Exercise Angina (exang)"], 10),
            oldpeak: parseFloat(formData["ST Depression (oldpeak)"]),
            slope: parseInt(formData["ST Slope (slope)"], 10),
            ca: parseInt(formData["Major Vessels (ca)"], 10),
            thal: parseInt(formData["Thalassemia (thal)"], 10)
        };

        console.log("Payload yang dikirim:", payload);

        fetch("http://127.0.0.1:5000/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
        })
            .then((response) => response.json())
            .then((data) => {
                const resultMessage = `
                    Prediksi: ${data.prediction === 1 ? "Ada Penyakit" : "Tidak Ada Penyakit"}<br>
                    Probabilitas: ${JSON.stringify(data.probability)}
                `;
                document.getElementById("resultMessage").innerHTML = resultMessage;
                const resultModal = new bootstrap.Modal(document.getElementById("resultModal"));
                resultModal.show();
            })
            .catch((error) => {
                console.error("Error:", error);
                alert("Terjadi kesalahan. Cek console untuk detail.");
            });
    }
    
    renderStep(currentStep);
</script>
</body>
</html>
